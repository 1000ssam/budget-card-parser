# 사업관리카드 파서 웹앱 구현 계획

## 목표
.xls/.xlsx 사업관리카드(예산) 파일을 업로드하면, 들여쓰기로 병합된 "세부사업/세부항목/원가통계비목" 컬럼을 자동으로 분리하여 정규화된 테이블로 보여주는 웹앱.

## 기술 스택
- **Next.js 14+ (App Router)** + TypeScript
- **SheetJS (xlsx)**: 클라이언트 사이드 .xls/.xlsx 파싱
- **Tailwind CSS**: 스타일링
- **Vercel**: 배포

## 핵심 파싱 로직

### 1단계: 헤더 감지
- 파일마다 컬럼 구성이 다를 수 있으므로, "세부사업/세부항목/원가통계비목" 텍스트가 포함된 셀을 찾아 A열(병합컬럼)의 위치를 자동 감지
- 해당 행과 그 아래 행(2-row 헤더)을 합쳐 나머지 컬럼 헤더를 동적으로 추출

### 2단계: 들여쓰기 기반 계층 파싱
- A열 각 셀의 선행 공백 수를 측정
- 공백 수를 기준으로 레벨 매핑 (유니크한 공백 수를 정렬하여 레벨 0~N 자동 결정)
  - 레벨 0: 합계 행 → 별도 처리 (소계 행)
  - 레벨 1: 세부사업
  - 레벨 2: 세부항목
  - 레벨 3: 원가통계비목 (실 데이터 행)
- 각 데이터 행에 현재 context의 세부사업/세부항목을 상속

### 3단계: 정규화된 테이블 생성
**출력 컬럼 구조:**
| 세부사업 | 세부항목 | 원가통계비목 | 산출내역 | (나머지 원본 컬럼들...) |

## 페이지 구성

### 단일 페이지 앱
1. **파일 업로드 영역**: 드래그앤드롭 + 클릭 업로드
2. **파싱 결과 테이블**:
   - 세부사업/세부항목/원가통계비목이 별도 컬럼으로 분리된 테이블
   - 셀 범위 드래그 선택 → 복사 가능
   - "전체 복사" 버튼 (탭 구분 텍스트로 클립보드에 복사, 엑셀에 바로 붙여넣기 가능)
3. **엑셀 다운로드 버튼**: 정규화된 xlsx 파일 다운로드

## 파일 구조
```
C:\dev\budget-card-parser\
├── src/
│   ├── app/
│   │   ├── layout.tsx
│   │   ├── page.tsx          # 메인 페이지
│   │   └── globals.css
│   ├── components/
│   │   ├── FileUploader.tsx   # 드래그앤드롭 업로드
│   │   ├── DataTable.tsx      # 결과 테이블 (드래그 복사 지원)
│   │   └── Toolbar.tsx        # 전체 복사 + 다운로드 버튼
│   └── lib/
│       ├── parser.ts          # 핵심 파싱 로직
│       └── export.ts          # xlsx 내보내기
├── next.config.ts
├── tailwind.config.ts
├── tsconfig.json
└── package.json
```

## 주요 구현 세부사항

### 파싱 (parser.ts)
- `parseWorkbook(workbook)` → `{ headers: string[], rows: ParsedRow[] }`
- 헤더 자동 감지: "세부사업" or "세부항목" or "원가통계비목" 텍스트 포함 셀 탐색
- 들여쓰기 레벨 자동 판별: 모든 A열 값의 선행 공백을 수집 → 유니크 값 정렬 → 인덱스가 레벨
- 상위 레벨 context를 stack/state로 관리하며 하위 행에 상속

### 테이블 (DataTable.tsx)
- HTML `<table>`에 `user-select: text` 보장
- 셀 드래그 선택 시 자연스러운 텍스트 선택 지원
- 전체 복사: 헤더 포함 TSV 형식으로 클립보드 복사 (엑셀 호환)

### 내보내기 (export.ts)
- SheetJS로 정규화된 데이터를 xlsx로 변환하여 다운로드
